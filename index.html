<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Rubik:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="style.css" />
    <title>Payment</title>
    <script
      type="module"
      src="https://unpkg.com/ionicons@5.4.0/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule=""
      src="https://unpkg.com/ionicons@5.4.0/dist/ionicons/ionicons.js"
    ></script>

    <script
      defer
      src="https://unpkg.com/smoothscroll-polyfill@0.4.4/dist/smoothscroll.min.js"
    ></script>
  </head>
  <body>
    <div class="container">
      <div class="card-body">
        <aside class="payment-info">
          <p class="title">Ngân hàng</p>
          <div class="bank">
            <img
              class="tp-logo"
              src="Icon-TPBank.webp"
              alt="Ngân hàng TPBank"
              width="24px"
              height="24px"
            />
            <p class="tp-bank">TP Bank</p>
          </div>
          <hr color="#ADB5BD" size="1px" noshade="noshade" align="center" />
          <p class="title">Số tài khoản</p>
          <p class="title-body">04288286101</p>
          <hr color="#ADB5BD" size="1px" noshade="noshade" />
          <p class="title">Tên tài khoản</p>
          <p class="title-body">NGUYEN XUAN TRUONG</p>
          <hr color="#ADB5BD" size="1px" noshade="noshade" />
          <p class="title">Số tiền</p>
          <p class="title-body">20.000 ₫</p>
          <hr color="#ADB5BD" size="1px" noshade="noshade" />
          <p class="title">Nội dung chuyển khoản</p>
          <p class="title-body">
            tooleopid<span class="title-description"> </span>
          </p>
        </aside>
        <main class="payment">
          <div class="logo-icon">
            <img src="logo.png" width="60px" height="60px" />
          </div>
          <hr />
          <p class="notification">Thông báo: Áp dụng phí cho Tool EOP</p>
          <p>
            Chào bạn, Mình xin thông báo rằng bắt đầu từ ngày 22/2/2024, mình sẽ
            áp dụng một khoản phí là <b>20.000đ/tháng</b> cho việc sử dụng tool
            EOP. Điều này giúp hệ thống được duy trì và phát triển.
          </p>
          <div class="qr-code">
            <strong>Quét QR để thanh toán cho mã tài khoản:</strong>
            <span class="title-description"></span>
          </div>

          <img class="qr-code-img" src="" width="400px" height="450px" />
          <button
            id="checkPaymentButton"
            onclick="checkPayment()"
            class="check-payment-button"
          >
            Đã thanh toán, kiểm tra
          </button>
          <div class="payment-options">
            <p class="line-6">
              Sau khi chuyển khoản có thể sẽ mất vài phút hoặc lâu hơn để hệ
              thống cập nhật, Nếu bạn gặp bất kỳ vấn đề hoặc câu hỏi nào, Liên
              hệ qua facebook
              <ion-icon class="logo-facebook" name="logo-facebook"></ion-icon>
              <a class="facebook-link" href="https://www.facebook.com/trgkyle"
                >Nguyen Truong</a
              >
            </p>
          </div>
          <div class="contact-info">
            <p class="copyright"><em>@Copyright Tool EOP 2024</em></p>
          </div>
        </main>
      </div>
    </div>
    <script>
      const params = new URLSearchParams(window.location.search);
      const tooleopId = params.get("tooleop-id");

      // Get the .title-body element
      const titleBodyElement =
        document.getElementsByClassName("title-description");

      // Set the tooleopId as the text of the .title-body element

      for (let i = 0; i < titleBodyElement.length; i++) {
        titleBodyElement[i].textContent = tooleopId;
      }
      document.querySelector(
        ".qr-code-img"
      ).src = `https://img.vietqr.io/image/TPB-04288286101-compact2.png?amount=20000&addInfo=tooleopid${tooleopId}&accountName=NGUYEN%20XUAN%20TRUONG`;

      // Function to check payment status
      function checkPayment() {
        const button = document.getElementById("checkPaymentButton");
        button.disabled = true;
        button.textContent = "Đang kiểm tra...";

        fetch("api/transaction/check-register", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ user_code: tooleopId }),
        })
          .then((response) => response.text())
          .then((data) => {
            if (data === "true") {
              button.textContent = "Thanh toán thành công!";
              // Add any additional actions for successful payment
            } else {
              button.textContent = "Kiểm tra lại";
              button.disabled = false;
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            button.textContent = "Lỗi, thử lại";
            button.disabled = false;
          });
      }
    </script>
  </body>
</html>
